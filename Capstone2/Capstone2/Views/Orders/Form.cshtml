@model Capstone2.Models.Order

@{
    ViewData["Title"] = "Place Order";
}

<div class="mb-3" style="position:absolute; left:10px; top:70px">
    <button type="button" class="btn btn-secondary" onclick="window.history.back();">
        <i class="bi bi-arrow-left"></i> Back
    </button>
</div>
<h2>Place an Order</h2>

@Html.ValidationSummary(true, "", new { @class = "text-danger" })

<form asp-action="Form" asp-controller="Orders" method="post" id="orderForm">

    <input type="hidden" name="OrderItemsJson" value="@TempData["OrderItemsJson"]" />

    <div class="form-group">
        <label asp-for="Customer.Name">Customer Name</label>
        <input asp-for="Customer.Name" class="form-control" required />
    </div>

    <div class="form-group">
        <label asp-for="Customer.ContactNo">Contact No.</label>
        <input asp-for="Customer.ContactNo" class="form-control" required />
    </div>

    <div class="form-group">
        <label asp-for="Customer.Address">Address</label>
        <input asp-for="Customer.Address" class="form-control" required />
    </div>

    <div class="form-group">
        <label asp-for="CateringDate">Catering Date</label>
        <input asp-for="CateringDate" type="date" class="form-control" required />
    </div>

    <div class="form-group">
        <label asp-for="Venue">Venue</label>
        <input asp-for="Venue" class="form-control" required />
    </div>

    <div class="form-group">
        <label asp-for="NoOfPax">Number of PAX</label>
        <input asp-for="NoOfPax" type="number" class="form-control" required />
    </div>

    <div class="form-group">
        <label asp-for="timeOfFoodServing">Time of Food Serving</label>
        <input asp-for="timeOfFoodServing" type="time" class="form-control" required />
    </div>

    <div class="form-group">
        <label asp-for="Occasion">Occasion</label>
        <input asp-for="Occasion" class="form-control" required />
    </div>

    <div class="form-group">
        <label asp-for="Motif">Motif</label>
        <input asp-for="Motif" class="form-control" required />
    </div>

    <div class="form-group">
        <label asp-for="TotalPayment">Total Payment</label>
        <input asp-for="TotalPayment" value="@Model.TotalPayment.ToString("0.00")" step="0.01" class="form-control" readonly />
    </div>
    <div class="alert alert-info mt-2">
        <strong>Reminder:</strong> You need to pay at least a <strong>50% down payment</strong> for your catering order to proceed.
    </div>
    <input type="submit" class="btn btn-primary" value="Place Order" />
</form>

<script>
    // Save form data to sessionStorage on submit
    document.getElementById('orderForm').addEventListener('submit', function () {
        var formData = {};
        var form = this;
        Array.from(form.elements).forEach(function (el) {
            if (el.name && (el.type !== 'submit' && el.type !== 'button')) {
                formData[el.name] = el.value;
            }
        });
        sessionStorage.setItem('orderFormData', JSON.stringify(formData));
    });

    // Restore form data from sessionStorage on page load
    window.addEventListener('DOMContentLoaded', function () {
        var saved = sessionStorage.getItem('orderFormData');
        if (saved) {
            var data = JSON.parse(saved);
            Object.keys(data).forEach(function (key) {
                var el = document.querySelector('[name="' + key + '"]');
                if (el) el.value = data[key];
            });
        }
    });

    // Clear sessionStorage after successful submit (optional, if you redirect on success)
    // You may want to clear it on the OrderDetails page after confirmation as well.
</script>
